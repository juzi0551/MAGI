# 需求文档

## 介绍

MAGI系统是一个基于《新世纪福音战士》中的超级计算机系统设计的Web应用，通过三个不同人格（科学家、母亲、女人）对用户问题进行分析和决策。本项目涉及将现有基于Dash的MAGI系统重构为React+Vite框架，以提升开发体验、性能和可维护性，同时保持原有的EVA风格视觉设计和功能特性。

## 需求

### 需求 1

**用户故事：** 作为用户，我希望与基于React+Vite的MAGI系统交互，该系统保持原有的EVA视觉风格和功能，以便我能体验到改进的性能和用户界面响应性。

#### 验收标准

1. 当应用程序加载时，系统应显示具有特色EVA橙色（#ff8d00）配色方案和MAGI-Matisse字体的MAGI界面
2. 当系统空闲时，三个贤者组件应以默认状态显示，并具有适当的三角形连接
3. 当应用程序运行时，它应使用React 19.2、Vite 6.5和TypeScript 6.0构建
4. 当用户与界面交互时，系统应使用CSS动画提供流畅的动画和过渡效果

### 需求 2

**用户故事：** 作为用户，我希望向MAGI系统提问并接收来自三个不同AI人格的分析，以便我能获得全面的决策洞察。

#### 验收标准

1. 当我输入问题时，系统应确定这是是/否问题还是信息查询
2. 当系统处理我的问题时，它应同时查询三个AI人格（Melchior-科学家、Balthasar-母亲、Casper-女人）
3. 当每个AI响应时，系统应将响应分类为yes/no/conditional/info/error
4. 当收到所有三个响应时，系统应计算并显示最终决策状态
5. 当决策完成时，系统应根据结果播放适当的音频反馈（yes为2000Hz，no/error为3400Hz，conditional为2700Hz，info为2200Hz）

### 需求 3

**用户故事：** 作为用户，我希望配置多个AI服务提供商并在本地管理我的API密钥，以便我能选择最适合我需求的AI服务，同时保持凭据安全。

#### 验收标准

1. 当我访问设置时，系统应提供OpenRouter、OpenAI、Anthropic、Google、智谱AI、月之暗面、阿里云通义千问、百度文心千帆和DeepSeek的选项
2. 当我配置API提供商时，系统应仅将我的API密钥和设置存储在localStorage中
3. 当我选择提供商时，系统应使用该提供商的API进行所有AI请求
4. 当我更改提供商时，系统应无缝切换而不丢失当前会话数据

### 需求 4

**用户故事：** 作为用户，我希望查看和管理我的问题历史，以便我能回顾过去的决策并跟踪我的使用模式。

#### 验收标准

1. 当我提问时，系统应自动将问题、所有三个响应和最终决策保存到localStorage
2. 当我访问历史时，系统应显示带有时间戳的过去问题的时间顺序列表
3. 当我选择历史项目时，系统应显示详细信息，包括所有三个AI响应和条件
4. 当我想清除历史时，系统应提供删除单个项目或清除所有历史的选项
5. 当历史数据存在时，它应遵循指定的JSON结构，包含version、records和lastUpdated字段

### 需求 5

**用户故事：** 作为用户，我希望系统能在不同设备上响应式工作，以便我能在桌面、平板和移动设备上使用MAGI。

#### 验收标准

1. 当在桌面上查看时，系统应显示左右双栏布局
2. 当在平板上查看时，系统应适应单栏布局，右侧内容移至底部
3. 当在移动设备上查看时，系统应使用紧凑的单栏布局，隐藏装饰元素
4. 当布局改变时，所有功能应保持可访问和可用

### 需求 6

**用户故事：** 作为用户，我希望有音频反馈和视觉状态指示器，以便我能理解系统的当前状态和决策结果。

#### 验收标准

1. 当系统正在处理时，贤者组件应显示闪烁动画
2. 当达成决策时，系统应根据各自的响应改变贤者颜色（绿色表示同意，红色表示拒绝，橙色表示条件，蓝色表示信息，灰色表示错误）
3. 当启用音频时，系统应为不同结果播放指定频率的振荡器音调
4. 当我与音频设置交互时，系统应允许我启用/禁用音频并调整音量级别

### 需求 7

**用户故事：** 作为开发者，我希望有一个结构良好的TypeScript代码库，具有适当的关注点分离，以便系统可维护和可扩展。

#### 验收标准

1. 当检查代码库时，它应遵循指定的目录结构，包含components、context、hooks、services、types和utils的独立文件夹
2. 当审查组件时，它们应使用TypeScript接口进行适当的类型定义
3. 当查看状态管理时，它应使用React Context API，包含三个主要上下文：MagiContext、ConfigContext和HistoryContext
4. 当检查服务时，AI服务逻辑应与UI组件分离
5. 当审查存储时，localStorage操作应抽象到专用的服务模块中

### 需求 8

**用户故事：** 作为用户，我希望系统能优雅地处理错误并提供有意义的反馈，以便我能理解出了什么问题以及如何解决问题。

#### 验收标准

1. 当AI API调用失败时，系统应显示错误状态并继续处理可用的响应
2. 当网络连接丢失时，系统应显示适当的错误消息
3. 当使用无效的API密钥时，系统应提供关于身份验证问题的清晰反馈
4. 当localStorage不可用时，系统应优雅地降级功能并通知用户
5. 当发生意外错误时，系统应适当地记录错误并保持系统稳定性