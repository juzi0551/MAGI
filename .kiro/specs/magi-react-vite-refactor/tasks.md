# 实施计划

- [x] 1. 项目基础架构搭建
  - 创建React+Vite项目结构，配置TypeScript、ESLint和基础开发环境
  - 设置项目目录结构，包含src/components、src/context、src/hooks、src/services等文件夹
  - 配置Vite构建工具，设置开发服务器和生产构建选项
  - 创建基础的package.json和配置文件
  - _需求: 1.3, 7.1_

- [x] 2. TypeScript类型定义和接口
  - 创建核心数据类型定义文件(ai.ts, config.ts, history.ts)
  - 定义组件Props接口和Context接口
  - 实现错误类型和系统状态类型定义
  - _需求: 7.2, 8.1_

- [x] 3. CSS样式系统和主题搭建
  - 迁移现有CSS样式，保持EVA原作风格
  - 实现CSS变量系统，定义颜色方案(橙色#ff8d00主色等)和字体
  - 创建基础样式文件结构(base/, components/, variables.css)
  - 实现状态颜色系统(绿色-同意、红色-拒绝、橙色-条件等)
  - _需求: 1.1, 6.1, 6.2_

- [x] 4. 基础布局组件实现
  - 实现App.tsx主应用组件框架
  - 实现MagiSystem根组件，设置基础布局结构
  - 实现Header组件，显示左右标题("提訴"和"決議")
  - 创建基础的左右双栏布局容器
  - _需求: 1.1, 1.2_

- [x] 5. 核心MAGI视觉组件实现
  - 实现WiseMan组件，显示三贤者的圆形图标和基础状态
  - 实现Response组件，显示最终决策状态的视觉反馈
  - 实现Status组件，显示系统运行状态信息
  - 添加基础的状态颜色变化和动画效果
  - _需求: 1.1, 1.2, 6.1, 6.2_

- [x] 6. MAGI主容器和三角形布局
  - 实现MagiContainer组件，包含三角形连接线和整体MAGI布局
  - 实现三贤者的三角形排列和连接线绘制
  - 集成WiseMan、Response、Status组件到主容器中
  - 实现完整的MAGI视觉界面
  - _需求: 1.1, 1.4_

- [x] 7. 用户输入和交互组件
  - 实现InputContainer组件，处理用户问题输入
  - 添加问题提交和清空功能
  - 实现基础的用户交互反馈
  - 集成输入组件到主布局中
  - _需求: 2.1_

- [x] 8. 响应式设计实现
  - 实现桌面双栏布局(左侧MAGI界面，右侧贤者详情)
  - 实现平板单栏布局，右侧内容移至底部
  - 实现移动端紧凑布局，隐藏装饰元素
  - 使用CSS媒体查询确保所有功能在不同设备上可用
  - _需求: 5.1, 5.2, 5.3, 5.4_

- [x] 9. 本地存储服务实现
  - 实现configStorage服务，管理用户API配置的localStorage操作
  - 创建useLocalStorage自定义Hook，提供统一的存储接口
  - 实现基础的数据版本控制和迁移逻辑
  - 为配置管理准备存储基础 
  - _需求: 3.2, 4.1, 4.5_

- [x] 10. React Context状态管理系统
  - 实现ConfigContext，管理用户配置状态(API提供商、密钥等)
  - 实现MagiContext，管理核心应用状态(问题、系统状态、贤者回答)
  - 创建Context Provider组件，整合主要Context
  - 连接存储服务到状态管理系统
  - _需求: 7.3, 2.1_

- [ ] 11. 设置模态框实现
  - 实现SettingsModal组件，管理用户配置界面
  - 实现多AI提供商选择和API密钥配置
  - 连接ConfigContext和存储服务
  - 添加配置验证和保存功能，完成大模型配置开发
  - _需求: 3.1, 3.4_

- [ ] 12. AI服务层实现
  - 实现aiService.ts，支持多AI提供商的统一接口
  - 实现问题类型判断功能(是/否问题 vs 信息查询)
  - 实现三贤者并行查询逻辑，处理不同AI人格的响应
  - 实现响应状态分类和最终决策计算逻辑
  - 添加基础的错误处理和重试机制
  - _需求: 2.2, 2.3, 2.4, 3.1, 3.3, 8.1, 8.3_

- [ ] 13. 核心功能集成和测试
  - 将AI服务集成到MAGI组件中，实现完整的问答流程
  - 连接状态管理系统，实现组件间的数据流
  - 实现系统状态的实时更新和视觉反馈
  - 测试三贤者问答的完整流程，验证状态变化和UI更新
  - _需求: 2.1, 2.4_

- [ ] 14. 历史记录存储和功能
  - 扩展historyStorage服务，管理问题历史记录的本地存储
  - 实现HistoryContext，管理历史记录状态和操作方法
  - 实现历史记录的自动保存和管理功能
  - 为历史记录UI组件准备数据基础
  - _需求: 4.1, 4.5_

- [ ] 15. 音频效果系统
  - 实现useMagiAudio Hook，封装Web Audio API功能
  - 实现不同决策状态的音频反馈(yes: 2000Hz, no: 3400Hz等)
  - 添加音量控制和启用/禁用功能
  - 集成音频效果到决策完成流程中
  - _需求: 6.3, 6.4_

- [ ] 16. 历史记录UI组件实现
  - 实现HistoryPanel组件，显示可折叠的历史记录列表
  - 实现HistoryItem组件，显示单个历史记录项
  - 实现HistoryDetailModal组件，显示详细的历史记录信息
  - 连接历史记录存储服务，实现完整的历史记录功能
  - _需求: 4.2, 4.3, 4.4_

- [ ] 16. 错误处理和用户反馈
  - 实现ErrorBoundary组件，捕获和处理React错误
  - 实现API调用错误处理，显示有意义的错误信息
  - 实现网络连接错误和API密钥验证错误处理
  - 实现localStorage不可用时的降级处理
  - _需求: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 17. 性能优化和代码分割
  - 实现React.lazy懒加载非核心组件(设置模态框、历史详情等)
  - 使用React.memo优化组件渲染性能
  - 实现useMemo和useCallback优化计算和回调函数
  - 配置Vite代码分割，优化打包体积
  - _需求: 1.4_

- [ ] 18. 测试实现
  - 为核心组件编写单元测试(WiseMan, Response, Status等)
  - 为服务层编写测试(aiService, storage services)
  - 为自定义Hooks编写测试(useMagiAudio, useLocalStorage)
  - 实现集成测试，测试完整的问答流程
  - _需求: 7.1_

- [ ] 19. 数据迁移和兼容性
  - 实现从Dash版本的数据迁移逻辑
  - 确保历史记录数据格式兼容性
  - 实现配置数据的向后兼容
  - 添加版本检测和自动升级功能
  - _需求: 4.5_

- [ ] 20. 最终集成和优化
  - 集成所有组件和服务，确保完整功能正常工作
  - 进行端到端测试，验证完整的用户流程
  - 测试不同AI提供商的集成和切换
  - 验证响应式设计在不同设备上的表现
  - 进行性能测试和优化调整
  - _需求: 1.1, 2.1, 3.4, 5.4_

- [ ] 21. 构建配置和部署准备
  - 配置生产环境构建选项，启用代码压缩和优化
  - 配置静态资源处理，优化字体和图片加载
  - 实现环境变量配置，支持不同部署环境
  - 创建部署文档和使用说明
  - _需求: 1.3_

- [ ] 22. 文档和发布准备
  - 更新README.md，包含安装和使用说明
  - 创建用户使用指南和API配置说明
  - 准备发布版本，确保所有功能完整可用
  - 进行最终的代码审查和质量检查
  - _需求: 7.1_