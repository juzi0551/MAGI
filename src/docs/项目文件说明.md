# MAGI系统项目文件说明

## 项目概述

这是一个基于Python Dash框架实现的MAGI系统模拟器，高度还原《新世纪福音战士》中的MAGI超级计算机系统。项目采用前后端分离的架构，使用React组件构建用户界面，通过OpenAI GPT-4实现三个人格的智能回答。

## 项目结构

```
Src/
├── main.py              # 主应用程序入口
├── ai.py                # AI逻辑处理模块
├── requirements.txt     # Python依赖包列表
├── assets/             # 静态资源目录
│   └── style.css       # 样式文件
├── components/         # React组件目录
│   ├── magi.js         # MAGI主容器组件
│   ├── wise_man.js     # 三贤人组件
│   ├── response.js     # 响应状态组件
│   ├── header.js       # 头部组件
│   ├── modal.js        # 模态框组件
│   └── status.js       # 系统状态组件
└── docs/              # 项目文档目录
    └── 项目文件说明.md  # 本文档
```

## 核心文件详解

### 1. main.py - 主应用程序
**功能：** 应用程序的入口点，定义了整个MAGI系统的布局和回调逻辑。

**主要组件：**
- 使用Dash框架构建Web应用
- 定义了三个MAGI人格：Melchior（科学家）、Balthasar（母亲）、Casper（女人）
- 实现了问题处理的完整流程：输入 → 分析 → 回答 → 状态显示
- 管理组件间的数据流和状态同步

**关键回调函数：**
- `question()`: 处理用户输入的问题
- `annotated_question()`: 判断问题类型（是否为是/否问题）
- `wise_man_answer()`: 获取三个人格的回答
- `response_status()`: 计算最终决策状态
- `modal_visibility()`: 控制详细信息模态框的显示

### 2. ai.py - AI逻辑处理模块
**功能：** 封装与OpenAI GPT-4的交互逻辑，实现三个人格的智能回答。

**核心函数：**
- `is_yes_or_no_question()`: 判断输入问题是否为是/否问题
- `get_system_prompt()`: 为每个人格生成系统提示词
- `get_answer()`: 获取指定人格对问题的回答
- `classify_answer()`: 将回答分类为yes/no/conditional状态

**人格设定：**
- **Melchior（科学家）**: 专注于科学理解和技术进步
- **Balthasar（母亲）**: 关注保护和福祉
- **Casper（女人）**: 追求爱情、梦想和欲望

### 3. requirements.txt - 依赖包列表
**包含的主要依赖：**
- `dash==2.9.3`: Web应用框架
- `dash-extensions==1.0.0`: Dash扩展功能
- `dash-local-react-components==1.3.0`: 本地React组件支持
- `openai==0.27.6`: OpenAI API客户端
- `dash-mantine-components==0.12.1`: UI组件库

## React组件详解

### 1. components/magi.js - MAGI主容器
**功能：** 定义MAGI系统的整体布局容器。

**特点：**
- 创建三角形连接线，表示三个人格之间的关系
- 显示"MAGI"标题
- 作为所有子组件的容器

### 2. components/wise_man.js - 三贤人组件
**功能：** 显示三个MAGI人格的状态和回答。

**特点：**
- 根据回答状态显示不同颜色：
  - 绿色：同意（yes）
  - 红色：拒绝（no）
  - 蓝色：信息（info）
  - 渐变：条件性（conditional）
  - 黑色：错误（error）
- 处理中时显示闪烁动画
- 点击可打开详细信息模态框
- 每个人格有独特的几何形状（通过CSS clip-path实现）

### 3. components/response.js - 响应状态组件
**功能：** 显示MAGI系统的最终决策结果。

**状态显示：**
- `情 報` (info): 默认信息状态
- `合 意` (yes): 系统同意
- `拒 絶` (no): 系统拒绝
- `状 態` (conditional): 条件性同意
- `誤 差` (error): 系统错误

### 4. components/header.js - 头部组件
**功能：** 显示系统的头部标题区域。

**特点：**
- 支持左右两侧显示
- 默认显示"質 問"（问题）和"解 決"（解决）
- 使用水平线装饰

### 5. components/modal.js - 模态框组件
**功能：** 显示详细的问题和回答信息。

**显示内容：**
- 问题内容
- 回答状态
- 错误信息
- 条件信息
- 完整回答文本

### 6. components/status.js - 系统状态组件
**功能：** 显示MAGI系统的运行状态信息。

**状态信息：**
- `CODE:473`: 系统代码
- `FILE:MAGI_SYS`: 文件标识
- `EXTENTION:xxxx`: 扩展状态（根据问题类型动态变化）
- `EX_MODE:OFF`: 扩展模式状态
- `PRIORITY:AAA`: 优先级设置

## 样式文件详解

### assets/style.css - 主样式文件
**功能：** 定义整个MAGI系统的视觉样式，高度还原EVA原作中的界面设计。

**主要样式特点：**
- **背景设计**: 使用斜纹渐变背景，营造科幻氛围
- **网格布局**: 复杂的CSS Grid布局，精确定位各个组件
- **几何形状**: 使用clip-path创建三个人格的独特形状
- **颜色方案**: 主要使用橙色（#ff8d00）作为主题色
- **动画效果**: 闪烁动画表示处理状态
- **响应式设计**: 使用容器查询单位（cqh, cqw）实现自适应

**关键样式类：**
- `.system`: 整体系统容器
- `.magi`: MAGI主网格布局
- `.wise-man`: 三贤人组件样式
- `.response`: 响应状态样式
- `.modal`: 模态框样式
- `.flicker`: 闪烁动画

## 系统工作流程

1. **用户输入**: 用户在输入框中输入问题和API密钥
2. **问题分析**: 系统判断问题是否为是/否类型
3. **人格回答**: 三个MAGI人格并行处理问题并给出回答
4. **状态计算**: 根据三个人格的回答计算最终决策状态
5. **结果显示**: 在界面上显示各人格状态和最终决策结果
6. **详细查看**: 用户可点击人格查看详细回答信息

## 技术特点

1. **高度还原**: 界面设计完美复现EVA原作中的MAGI系统
2. **智能回答**: 集成GPT-4实现真正的智能对话
3. **实时交互**: 基于Dash的实时回调机制
4. **模块化设计**: React组件化架构，便于维护和扩展
5. **响应式布局**: 自适应不同屏幕尺寸
6. **状态管理**: 完整的状态同步和错误处理机制

## 扩展建议

基于当前实现，可以考虑以下扩展方向：

1. **完善人格设定**: 实现更详细的角色扮演指令
2. **投票机制**: 添加明确的APPROVED/REJECTED投票逻辑
3. **交互模式**: 实现用户选择和方案优化功能
4. **协作模式**: 添加不同的决策顺序模式
5. **特殊权限**: 实现Casper的特殊否决权机制
6. **音效支持**: 添加EVA原作中的音效
7. **数据持久化**: 保存历史问答记录
8. **多语言支持**: 支持中英文切换